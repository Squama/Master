<link rel="stylesheet" href="${basePath}/resources/common/libs/fileinput/css/fileinput.min.css">
<style>

#projectaddstep2 .krajee-default.file-preview-frame .kv-file-content {
    height: auto;
}

#projectaddstep2 .krajee-default .file-footer-caption {
    width: 100px;
}

</style>
<script src="${basePath}/resources/common/libs/fileinput/js/fileinput.js"></script>
<script src="${basePath}/resources/common/libs/fileinput/js/locales/zh.js"></script>
<!--BaseFile组件-->
<script src="${basePath}/resources/common/js/base-file.js"></script>
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><li class="fa fa-remove"></li></button>
    <h5 class="modal-title"></h5>
</div>
<div class="modal-body" style="max-height:500px;overflow-y:auto;">

    <form id="contract-form" name="contract-form" class="form-horizontal">
    <!-- /.box-body -->
        <div class="" style="text-align: center;height:50px;width:100%;">
            <!--以下两种方式提交验证,根据所需选择-->
            <button type="submit" class="btn btn-primary" data-btn-type="save" id="b_sub">保存并提交</button>
        </div>
     <input type="hidden" name="id" id= "id">
        <div class="box-body">
            <div class="col-md-6">
                
				<div class="form-group">
                    <label  for="workerid" class="col-sm-3 control-label">姓名</label>
					<div class=" col-sm-8">
						<select id="workerid" class="form-control select2 "  name="workerid" style="width:100%" onchange="setvalue()">
                   			<option selected="selected" value="">选择一个人员</option>
                   		</select>
					</div>
                </div>
                <div class="form-group">
                     <label for="whcd" class="col-sm-3 control-label">文化程度</label>
                     <div class="col-sm-8">
                         <input type="text" class="form-control" id="whcd" name="whcd" placeholder="文化程度" disabled="disabled">
                     </div>
                 </div>
                <div class="form-group">
                    <label for="birthday" class="col-sm-3 control-label">出生日期</label>
                    <div class="input-group date col-sm-8">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" class="form-control" data-flag="datepicker"
                               data-format="yyyy-mm-dd"
                               id="birthday" name="birthday"
                               placeholder="出生日期" autocomplete="off" disabled="disabled">
                    </div>
                </div>
                <div class="form-group">
                    <label for="address" class="col-sm-3 control-label">家庭住址</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="address" name="address" placeholder="家庭住址" disabled="disabled">
                    </div>
                </div>
            </div>
            <div class="col-md-6">
            	<div class="form-group">
                    <label  for="sex" class="col-sm-3 control-label">性别</label>
					<div class=" col-sm-8">
						<select id="sex" class="form-control"  name="sex" style="width:100%"  disabled="disabled">
                   			<option selected="selected" value="1">男</option>
                   			<option  value="0">女</option>
                   		</select>
					</div>
                </div>
            	<div class="form-group">
                    <label for="workType" class="col-sm-3 control-label">工种</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="workType" name="workType" placeholder="工种" disabled="disabled">
                    </div>
                </div>
                <div class="form-group">
                   <label for="jctime" class="col-sm-3 control-label">进场时间</label>
                   <div class="input-group date col-sm-8">
                       <div class="input-group-addon">
                           <i class="fa fa-calendar"></i>
                       </div>
                       <input type="text" class="form-control" data-flag="datepicker"
                              data-format="yyyy-mm-dd"
                              id="jctime" name="jctime"
                              placeholder="进场时间" autocomplete="off" disabled="disabled">
                   </div>
               </div>
               <!-- <div class="form-group">
                    <label  for="jyid" class="col-sm-3 control-label">三级教育</label>
					<div class=" col-sm-8">
						<input id="jyname" name="jyname" style="display: none"/>
						<select id="jyid" class="form-control select2 "  name="jyid" style="width:100%" onchange="setvalue()">
                   			<option selected="selected" value="">选择一个三级教育</option>
                   		</select>
					</div>
                </div> -->
            </div>
            </div>
            <div class="form-group">
                    <label for="bzjy" class="col-sm-2 control-label">班组教育内容</label>

                    <div class="col-sm-9">
                        <textarea class="form-control" id="bzjy" name="bzjy" placeholder="班组教育内容" rows="8" disabled="disabled"></textarea>
                    </div>
            </div>
             <div class="form-group">
                    <label for="bzjy" class="col-sm-2 control-label">项目教育内容</label>

                    <div class="col-sm-9">
                        <textarea class="form-control" id="xmjy" name="xmjy" placeholder="项目教育内容" rows="8" disabled="disabled"></textarea>
                    </div>
            </div>
             <div class="form-group">
                    <label for="gsjy" class="col-sm-2 control-label">公司教育内容</label>

                    <div class="col-sm-9">
                        <textarea class="form-control" id="gsjy" name="gsjy" placeholder="公司教育内容" rows="8" disabled="disabled"></textarea>
                    </div>
            </div>
        
        <!-- /.box-footer -->
    </form>
</div>
<script>
    var form =null;
    
    var rys = '${rys?default(0)}',ry=0;
    if(rys != 0){
    	ry = JSON.parse(rys);
    }
    /* var jys = '${jys?default(0)}',jy=0;
    if(jys != 0){
    	jy = JSON.parse(jys);
    } */
    var lx = '${lx?default(0)}';
    var id = '${id?default(0)}';
    if(id!=0){
    	  $("#b_sub").css("display","none");
    	  $("#workerid").attr("disabled",true);
    	  $("#jyid").attr("disabled",true);
      }
    $(function() {
        //初始化控件
        form=$("#contract-form").form();
        //数据校验
        $("#contract-form").bootstrapValidator({
            message : '请输入有效值',
            feedbackIcons : {
                valid : 'glyphicon glyphicon-ok',
                invalid : 'glyphicon glyphicon-remove',
                validating : 'glyphicon glyphicon-refresh'
            },
            submitHandler : function() {
                modals.confirm('确认保存？', function() {
                    //Save Data，对应'submit-提交'
                    var params = form.getFormSimpleData();
                    	ajaxPost(basePath+'/sjjynr/saveJy', params, function(data) {
                            if(data.success){
                            	 modals.correct("流程已启动，请联系组长及时处理");
                                 $("#b_sub").css("display","none");
                            }else{
                            	 modals.error(data.message);
                            }                
                        }); 
              
                     
                });
            },
            fields : {
            	workerid : {
                    validators : {
                        notEmpty : {
                            message : '请选择人员'
                        }
                    }
                }/* ,
                jyid : {
                    validators : {
                        notEmpty : {
                            message : '请选择三级教育'
                        }
                    }
                } */
            }
        });
        if(ry != 0){
            for (var i = 0, len = ry.length; i < len; i++) {
                var u = ry[i];
                $('#workerid').append("<option value='" + u.id + "'>" + u.name + "</option>");
            }
            $("#workerid").select2();
        }
        /* if(jy != 0){
            for (var i = 0, len = jy.length; i < len; i++) {
                var u = jy[i];
                $('#jyid').append("<option value='" + u.id + "'>" + u.descs + "</option>");
            }
            $("#jyid").select2();
        } */
        form.initComponent();
        load();
       /*  $("#jyid").on("change",function(){
			getJynr();
        }) */
    });
    function getJynr(){
		var jyxz = $("#jyid option:selected").val();
		if(jyxz){
			ajaxPost(basePath+'/sjjynr/load', {id:jyxz}, function(data) {
				$("#bzjy").val(data.bzname);
				$("#xmjy").val(data.xmname);
				$("#gsjy").val(data.gsname);        
				$("#jyname").val(data.descs); 
            }); 
		}else{
			$("#bzjy").val("");
			$("#xmjy").val("");
			$("#gsjy").val("");
			$("#jyname").val(""); 
		}
    }
    function load(){
		if(id!=0){//查看
			ajaxPost(basePath+'/sjjynr/loadJy', {id:id}, function(data) {
				$("#contract-form").form().initFormData(data);   
			 }); 
		}else{//初始化
			ajaxPost(basePath+'/sjjynr/load', {}, function(data) {
				$("#bzjy").val(data.bzname);
				$("#xmjy").val(data.xmname);
				$("#gsjy").val(data.gsname);       
            }); 
		}
    }
    function setvalue(){
		var workid = $("#workerid option:selected").val();
		if(workid){
			ajaxPost(basePath+'/sjjynr/getWorker', {workid:workid}, function(data) {
				$("#whcd").val(data.whcd);
				$("#birthday").val(jsonYearMonthDay(data.birthday));
				$("#sex").val(data.sex);
				$("#workType").val(data.workType);
				$("#jctime").val(jsonYearMonthDay(data.jctime)); 
				$("#address").val(data.address);
            }); 
		}else{
			 modals.correct("请选择人员");
		}
     }
    function resetForm(){
        form.clearForm();
        $("#contract-form").data('bootstrapValidator').resetForm();
    }
    function jsonYearMonthDay(milliseconds) {
		if (milliseconds == "" || milliseconds == undefined
				|| milliseconds == null) {
			return "";
		} else {
			var datetime = new Date();
			datetime.setTime(milliseconds);
			var year = datetime.getFullYear();
			var month = datetime.getMonth() + 1 < 10 ? "0"
					+ (datetime.getMonth() + 1) : datetime.getMonth() + 1;
			var date = datetime.getDate() < 10 ? "0" + datetime.getDate()
					: datetime.getDate();
			return year + "年" + month + "月" + date+"日";
		}
	}
</script>
